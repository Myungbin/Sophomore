---
title: "텍스트마이닝 과제4"
author: "MYUNG BIN KWAK"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(readxl)
library(readr)
library(dplyr)
library(tidyr)
seoul <- read_excel("seoul.xlsx")
```

```{r, echo = FALSE, out.width = "75%", fig.align = "left"}
include_graphics("q1.png")
```

## 1. 서울 지역번호인 02 를 포함하고 있는 전화번호 추출
```{r}
phone <- seoul$`업소 전화번호`
head(phone, 10)
grep('^02|02)', phone, value = T) #지역번호인 02를 추출출
```

## 2. 지역번호가 없는 전화번호

```{r}
phone[!grepl("02-|02)",phone)]   # 지역번호인 02-와 02)를 제외하고 추출
q2 <- phone[!grepl("02-|02)",phone)] 
```

## 3. 2번에서 찾은 지역번호가 없는 전화번호들에 모두 02를 추가

```{r}
str(q2)
gsub("^", "02-", q2)   ## gsub을 통해 02- 를추가 
q3 <- gsub("^", "02-", q2)  
```

## 4. 앞의 1이나 3에서 해결되지 않는 전화번호

```{r}
grep('^02-010|02-070|02-없음|02-0|02--',q3 , value = T) # 3번에서 02를 추가한 데이터중 비정상적 데이터를 추출 (010, 없음, - , -- )
```



```{r, echo = FALSE, out.width = "75%", fig.align = "left"}
include_graphics("q2.png")
```

```{r}
seoul <- subset(seoul, 분류코드=="001" | 분류코드=="002" | 분류코드=="003" )
str(seoul) 
info <- seoul$업소정보
str(info)
```
## 1. 영업시간 정보를 추출해보자
```{r}
a1 <- gsub("좌석수.*","", info)  # 좌석수 뒷부분을 없애기

a2 <- gsub("휴무일.*","", a1)    # 휴무일 뒷부분 없애기

a3 <- gsub("좌석수.*", "", a2)   # 좌석수 뒷부분 없애기

a4 <- gsub("좌 석 수.*", "", a3) # 좌 석 수 뒷부분 없애기

a5 <- gsub("예약.*", "", a4)     # 예약 뒷부분 없애기

a6 <- gsub("배달.*", "", a5)     # 배달 뒷부분 없애기

a7 <- gsub("휴뮤일.*", "", a6)     # 휴뮤일 뒷부분 없애기

a8 <- gsub("기타.*", "", a7)     # 기타 뒷부분 없애기

a9 <- gsub("휴무.*", "", a8)     #  휴무 뒷부분 없애기

a10 <- gsub("배   달.*", "", a9)     #  배   달뒷부분 없애기

a11 <- gsub("할인 내용.*", "", a10)     #  배   달뒷부분 없애기

a12 <- gsub("-", "~", a11)            # - 를 ~ 로 바꾸기 (문제2번 때문)


## 영업시간만 나타나는 자료
a12
a13<- na.omit(a12) ## NA 없애기 
a13
```


## 2. 영업시작 시간과 영업종료 시간을 분류해보자 
```{r}
st <- gsub("~.*", "", a13) # 영업 시작시간
st

ed <- gsub(".*~", "", a13)  # 영업 종료시간
ed

```


## 3. 시간정보를 추출할때 어떤 어려움이 있고 어떤 점에 유의해야 하는가?

info 데이터안에는 영업시간외 여러 데이터 들이 존재했다. 그래서 우리가 해야하는 영업시간만을 표시를 해야해서 데이터 전처리를 해야만 했다. 가게마다 정보항목을 통일시키지 않았다. 대부분의 가게는 영업시간뒤에 좌석수를 적어놓긴 했지만 그렇지 않은 가게들도 굉장히 많았다. 만들어 놓은 2-1번 문제를 보면 a1~12는 영업시간 뒤에 있는 항목을 지운것들이다. 좌석수뿐만이 아니라 휴무, 배달등 여러개의 단어가 나와있어서 영업시간만 나타내는 데이터를 만드는데 힘겨움이 있었다. 또한 각 가게마다 시간정보또한 통일되지 못했다. 시간단위가  가게마다 달라서 데이터를 분류하는게 어려움이 있다. 또한 가게의 특성상 매일 영업하는 것이 아닐수도 있고 24시간 하는가게는 24시간 이라 적어놓아서 시작과 종료시간의 구분이 없었다. 데이터를 전처리 하는 과정에서 영업시간데이터를 건드리지 않는것이 중요할것이다. gsub을 통해 바꾸면서 시간 데이터와 영업시간을 나타내 우리가 원하는 데이터만 추출해 내는것이 중요하다. 



